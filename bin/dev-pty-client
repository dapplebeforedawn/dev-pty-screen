#! /usr/bin/env ruby

require 'socket'
require 'io/console'

require_relative '../lib/client/app'

Thread.abort_on_exception = true
READSIZE = 4096

key_sock    = Socket.tcp(App.options.server_host,    App.options.key_port)
screen_sock = Socket.tcp(App.options.server_host, App.options.screen_port)

Thread.new do
  loop { STDOUT.write screen_sock.readpartial( READSIZE ) }
end

# getch is the reason the arrow keys don't work.
# how to fix?  I am dissapoint.
Thread.new do
  loop { key_sock.write STDIN.getch }
end

sleep
